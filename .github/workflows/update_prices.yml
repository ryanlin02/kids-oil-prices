name: Update Oil Prices

on:
  schedule:
    # 每天早上 8 點和下午 6 點執行 (UTC+0 時間，對應台灣時間約為早上 16 點和凌晨 2 點)
    - cron: '0 0,8,16 * * *'
  workflow_dispatch:  # 允許手動觸發工作流程

jobs:
  update-prices:
    runs-on: ubuntu-latest
    
    steps:
      - name: 檢出儲存庫
        uses: actions/checkout@v2
        
      - name: 設置 Python
        uses: actions/setup-python@v2
        with:
          python-version: '3.9'
          
      - name: 安裝相依套件
        run: |
          python -m pip install --upgrade pip
          pip install requests beautifulsoup4 pytz
          
      - name: 執行爬蟲更新油價
        run: |
          mkdir -p data
          python scripts/fetch_oil_prices.py
          
      - name: 提交更新的資料
        run: |
          git config --local user.email "action@github.com"
          git config --local user.name "GitHub Action"
          git add data/oil_prices.json
          git diff --quiet && git diff --staged --quiet || git commit -m "自動更新油價資料 $(date +'%Y-%m-%d %H:%M:%S')"
          
      - name: 推送變更
        uses: ad-m/github-push-action@master
        with:
          github_token: ${{ secrets.GITHUB_TOKEN }}
          branch: ${{ github.ref }}
